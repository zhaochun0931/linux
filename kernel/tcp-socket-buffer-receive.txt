The system-wide TCP socket buffers temporarily store data that the kernel has received or should send. 
Both net.ipv4.tcp_rmem (read) and net.ipv4.tcp_wmem (write) socket buffer kernel settings contain three settings: A minimum, default, and maximum value.



tcp_rmem is a Linux kernel parameter that controls the TCP receive buffer sizes.
It defines how much data the kernel can buffer for incoming TCP packets for each socket.

This directly affects performance, throughput, and memory usage.


sysctl net.ipv4.tcp_rmem


Typical output:

net.ipv4.tcp_rmem = 4096 87380 6291456


| Position | Name        | Meaning                                 |
| -------- | ----------- | --------------------------------------- |
| 1        | **min**     | Minimum TCP receive buffer size         |
| 2        | **default** | Default buffer size for new TCP sockets |
| 3        | **max**     | Maximum auto-tuned receive buffer size  |








ğŸ“¦ 1. Minimum buffer (min)

Kernel will never allow receive buffer to fall below this.

Helps with very low-bandwidth connections.

Example: 4096 bytes (4 KB)

ğŸ“¦ 2. Default buffer (default)

Applied to new TCP sockets when they are created.

Typical value: 87380 (â‰ˆ 85 KB)

This affects how much data a connection can receive without ACKing.

ğŸ“¦ 3. Maximum buffer (max)

The largest buffer the kernel can auto-tune up to.

Must be large for high-bandwidth, high-latency (high BDP) connections.

Typical example: 6291456 (6 MB)

ğŸ§  Auto-tuning

Linux dynamically increases the receive buffer depending on:

network congestion

throughput

RTT

packet loss

It cannot exceed the tcp_rmem max.

ğŸï¸ When to adjust tcp_rmem?
Increase it if you have:

High bandwidth (1â€“10 Gbps)

High latency links

Busy servers with many connections

Video streaming

Heavy API traffic

Kafka / RabbitMQ over TCP

Example optimized setting:
sysctl -w net.ipv4.tcp_rmem="4096 87380 16777216"


Max = 16 MB.

â— Relationship to net.core.rmem_max

net.core.rmem_max is a hard limit for all receive buffers.

To raise TCP max above 6 MB, you must also increase the system-wide limit:

sysctl -w net.core.rmem_max=16777216


Otherwise, TCP cannot grow its auto-tuned buffer.

ğŸ¯ Summary

tcp_rmem controls per-socket TCP receive buffer sizes:

tcp_rmem = [ min, default, max ]









| Example   | Meaning                             |
| --------- | ----------------------------------- |
| `4096`    | Minimum buffer                      |
| `87380`   | Default buffer                      |
| `6291456` | Max buffer (auto-tuned upper bound) |









ğŸ“Œ How they interact (important)
When a TCP socket is created:

It starts with:

rmem_default
wmem_default


Then TCP overrides or expands using:

tcp_rmem default  (read)
tcp_wmem default  (write)


During traffic, Linux auto-tunes between:

tcp_{rmem,wmem} min â†’ max

ğŸ§  Example timeline for a TCP connection
ğŸ“ Step 1 â€” New socket created

Receive buffer = rmem_default
Send buffer = wmem_default

ğŸ“ Step 2 â€” TCP protocol handler starts

Kernel applies tcp_rmem default and tcp_wmem default.

Often these are bigger than rmem/wmem defaults.

ğŸ“ Step 3 â€” Auto-tuning during connection

TCP adjusts the buffer dynamically up to tcp_rmem max / tcp_wmem max.

rmem_default and wmem_default do not apply anymore.






The socket buffer, or "SKB", is the most fundamental data structure in the Linux networking code. Every packet sent or received is handled using this data structure.

skbuffs are the buffers in which the linux kernel handles network packets. The packet is received by the network card, put into a skbuff and then passed to the network stack, which uses the skbuff all the time.


