ðŸ§© Lab 2: Subnets and Routing

ðŸ§± Goal: Understand routes and gateways.



Create 3 namespaces: host1, router, host2.




sudo ip netns add host1
sudo ip netns add router
sudo ip netns add host2

# Create veth pairs
sudo ip link add veth1 type veth peer name veth1r
sudo ip link add veth2 type veth peer name veth2r

# Connect them
sudo ip link set veth1 netns host1
sudo ip link set veth1r netns router
sudo ip link set veth2 netns host2
sudo ip link set veth2r netns router

# Assign IPs
sudo ip -n host1 addr add 10.0.1.1/24 dev veth1
sudo ip -n router addr add 10.0.1.254/24 dev veth1r
sudo ip -n host2 addr add 10.0.2.1/24 dev veth2
sudo ip -n router addr add 10.0.2.254/24 dev veth2r

# Bring them up
for ns in host1 router host2; do
  sudo ip -n $ns link set lo up
done

for iface in veth1 veth1r veth2 veth2r; do
  sudo ip -n $( [[ $iface =~ r$ ]] && echo router || echo host${iface:4:1} ) link set $iface up
done

# Enable routing on router
sudo ip netns exec router sysctl -w net.ipv4.ip_forward=1

# Add default routes
sudo ip -n host1 route add default via 10.0.1.254
sudo ip -n host2 route add default via 10.0.2.254


for i in host1 host2 router
do 
echo $i
ip -n $i link show
echo
done



# Test ping
sudo ip netns exec host1 ping -c 2 10.0.2.1


âœ… Result: You built a real routed network.
Host1 â†” Router â†” Host2 â€” all isolated in your machine.





