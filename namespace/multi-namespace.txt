     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  ns1     â”‚<--veth-â”‚   bridge   â”‚--veth->â”‚  ns2     â”‚
     â”‚10.0.0.11 â”‚        â”‚br0:10.0.0.1â”‚        â”‚10.0.0.12 â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                               (NAT to Internet)






ğŸ§© Step 1 â€” Create two namespaces
sudo ip netns add ns1
sudo ip netns add ns2


Check:

sudo ip netns list





ğŸ”Œ Step 2 â€” Create a bridge and veth pairs

Weâ€™ll make one veth pair per namespace.

sudo ip link add veth-ns1 type veth peer name veth-br1
sudo ip link add veth-ns2 type veth peer name veth-br2


Create a bridge br0:

sudo ip link add name br0 type bridge


Add bridge interfaces:

sudo ip link set br0 up
sudo ip addr add 10.0.0.1/24 dev br0
sudo ip link set veth-br1 master br0
sudo ip link set veth-br2 master br0
sudo ip link set veth-br1 up
sudo ip link set veth-br2 up

ğŸŒ Step 3 â€” Move veth peers into namespaces
sudo ip link set veth-ns1 netns ns1
sudo ip link set veth-ns2 netns ns2

âš™ï¸ Step 4 â€” Configure interfaces in each namespace
ğŸŸ¢ ns1
sudo ip netns exec ns1 ip addr add 10.0.0.11/24 dev veth-ns1
sudo ip netns exec ns1 ip link set veth-ns1 up
sudo ip netns exec ns1 ip link set lo up
sudo ip netns exec ns1 ip route add default via 10.0.0.1

ğŸ”µ ns2
sudo ip netns exec ns2 ip addr add 10.0.0.12/24 dev veth-ns2
sudo ip netns exec ns2 ip link set veth-ns2 up
sudo ip netns exec ns2 ip link set lo up
sudo ip netns exec ns2 ip route add default via 10.0.0.1

ğŸ§ª Step 5 â€” Test connectivity

Ping between namespaces:

sudo ip netns exec ns1 ping -c 2 10.0.0.12
sudo ip netns exec ns2 ping -c 2 10.0.0.11


âœ… Should both succeed.

ğŸŒ Step 6 â€” Enable Internet access via NAT

Enable IP forwarding:

echo 1 | sudo tee /proc/sys/net/ipv4/ip_forward


Add NAT rule:

sudo iptables -t nat -A POSTROUTING -s 10.0.0.0/24 -j MASQUERADE


Now test from ns1 or ns2:

sudo ip netns exec ns1 ping -c 3 8.8.8.8
sudo ip netns exec ns2 ping -c 3 1.1.1.1


âœ… Internet access should now work.

ğŸ§° Step 7 â€” Try a demo service

Run a web server in ns1:

sudo ip netns exec ns1 python3 -m http.server 8080 &


From ns2, test it:

sudo ip netns exec ns2 curl 10.0.0.11:8080


You should see:

Directory listing for /




ğŸ§¹ Step 8 â€” Clean up

When finished:

sudo ip netns del ns1
sudo ip netns del ns2
sudo ip link del br0
sudo iptables -t nat -D POSTROUTING -s 10.0.0.0/24 -j MASQUERADE
